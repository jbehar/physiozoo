---
layout: default
title: Getting Started
description: Examples on how to use the FECGSYN
author: Fernando Andreotti
priority: 2
---

In this section exemplary use of the <em>FECGSYN</em> are illustrated. Before running any of the examples you will need to <a href="{{site.github.url}}/pages/install.html"><span class="octicon octicon-globe"></span> install the <em>FECGSYN</em> toolbox</a>.  For more information make sure you consult the <a href="{{site.github.url}}/pages/documentation.html"><span class="octicon octicon-globe"></span> Documentation</a>.

<section class="bs-docs-section">
 
<h1 id="datagen" class="page-header">Data Generation</h1>
<!-- datagen 1 -->
  <h2 id="datagen1">Initial NI-FECG simulation example</h2>

  <p> The code will produce simulation files, make sure to select the desired destination path on the Matlab root (<kbd>cd savedir</kbd>). An exemplary dataset can be simply generated and plotted by running the following lines:</p>
  
{% highlight matlab %}
param.fs = 1000; % data generation at 1kHz
param.n = 15*param.fs;
param.SNRfm = -3; % fetal maternal SNR
param.SNRmn = 8; % maternal to noise SNR
param.ntype = {'MA'}; % adding muscular artifact type noise
param.noise_fct = {1}; % noise at constant SNR level
debug = 5; % debug level (5 = max number of plots generated)
out = run_ecg_generator(param,debug);
FECGSYN_plotmix(out) % plots random channels of one of the created datasets
{% endhighlight %}
  
<p>Please consider that various parameters (e.g. location of fetal heart, location of noise sources) are not explicitely defined in the previous example. Therefore, to reproduce physiological conditions, running the code twice will produce considerably different signals. In the following examples, more complex simulations are performed, where further parameters are controlled.</p>
  
<!-- datagen 2 -->
  <h2 id="datagen2">Elaborate NI-FECG simulation example</h2>

  <p>This example make use of the <code>exp_datagen1.m</code> function to generate the dataset used in (Behar et al 2014). The code will produce simulation files, so be sure to <kbd>cd dirname</kbd> the desired destination path. </p>

{% highlight matlab %}
pathdir = pwd;
exp_datagen1(pathdir,5,false) % generate dataset (may take a few minutes)
load('fecgsyn_c1.mat')
FECGSYN_plotmix(out) % plots random channels of one of the created datasets
{% endhighlight %}

 <h2 id="datagen3">Further examples</h2>
  
  <p>Similarly to the <code>exp_datagen1.m</code> example, the <em>FECGSYN</em> includes three further pre-built routines to data generation. For performance purpose, these functions DO NOT include wfdb support. Nevertheless, this can be simply expanded by using the <code>fecgsyn2wfdb.m</code> function (see <a href="{{site.github.url}}/pages/examples.html#fecgsyn2wfdb"><span class="octicon octicon-arrow-small-up"></span> this example</a>). Below is a list of further examples included and a short description. For mor information, see  : </p>
 
  <ul>
    <li><code>FECGSYNDB_datagen.m</code>: This function generates a dateset similar to the one used in (Andreotti et al 2016).</li>
    <li><code>exp_datagen2.m</code>: This example performs some additional maternal ECG amplitude changes (after generation) and SNR modulation (during generation). It is useful to stress testing the ability of Template Subtraction techniques in adapting their average template to an ECG with varying amplitude. More information is available in the <a href="{{site.github.url}}/pages/documentation.html#exp_datagen2"><span class="octicon octicon-globe"></span> Documentation</a>. </li>
    <li><code>exp_datagen3.m</code>: This example include highly oscilatting (e.g sinusoidal) changes in the noise SNR level and ECG amplitude changes. The aim of the dataset generate is to train algorithms that detect variations in the  MECG/FECG signal quality, i.e. signal quality indexes (SQIs).  More information is available in the <a href="{{site.github.url}}/pages/documentation.html#exp_datagen3"><span class="octicon octicon-globe"></span> Documentation</a>.</li>
  </ul>
 
 <div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body">  Since some parameters generated by the FECGSYN are randomly selected, the database generated by <code>FECGSYNDB_datagen.m</code> will <u>NOT</u> be identical. For comparison purposes with (Andreotti <em>et al</em> 2016), make sure to download Physionet's FECGSYNDB ( <a href="https://www.physionet.org/physiotools/ipmcode/fecgsyn/"><span class="octicon octicon-globe"></span> available here</a>). </div></div>  
   
 <p><b>Reference:</b></p>
<blockquote style="font-size:12px"> Behar J., Andreotti F., Zaunseder S., Li Q., Oster J. and Clifford G D., An ECG model for simulating maternal-foetal activity mixtures on abdominal ECG recordings. Physiol Meas 35, pp.1537-50, 2014. </blockquote>
<blockquote style="font-size:12px"> Andreotti F., Behar J., Zaunseder S.,Oster J. and Clifford G D., An Open-Source Framework for Stress-Testing Non-Invasive Foetal ECG Extraction Algorithms. <em>Physiol Meas</em> <b>37(5)</b>, pp. 627-648, 2016. </blockquote>

</section> <hr>

<!-------------FECG EXTRACTION--------->
<section class="bs-docs-section">
<h1 id="datext" class="page-header">FECG Extraction</h1>

<h2 id="tsc">Extraction using Template Subtraction</h2>

<p>This minimalistic example makes use of the template subtraction (TS) method by Cerutti et al 1986, using the <code>FECGSYN_ts_extraction.m</code> function, using the <kbd>test.mat</kbd> examplary set. As input the function expects the maternal QRS locations (<code>mref</code>), abdominal signal (<code>mixture</code> - rows represent different channels), a predetermined number of cycles to use on the average maternal template (<code>NbCycles</code>) and sampling frequency used (<code>fs</code>). See the example:</p>

{% highlight matlab %}
old_path=which('FECGSYN_UI') % find path to FECGSYN
slashchar = char('/'*isunix + '\'*(~isunix)); % find out OS
load([old_path(1:end-12) slashchar 'data' slashchar 'test.mat']) % load set
NbCycles = 20; % number of cycles used
ch = 3;
residual = FECGSYN_ts_extraction(out.mqrs,out.mixture(ch,:),'TS-CERUTTI',0,...
  NbCycles,'',out.param.fs);
% Plotting results
plot(out.mixture(ch,:),'Color',[0.8 0.8 0.8])
hold on
plot(residual)
plot(out.mqrs,2.*ones(1,length(out.mqrs)),'gd')
plot(out.fqrs{1},1,'xb')
legend('abdm mixture','extracted signal','MQRS','FQRS')
hold off
{% endhighlight %}

<p>As output, the function returns the <code>residual</code> variable, which has the same dimensions as <code>mixture</code>.</p>

<p><b>Reference:</b></p>

<blockquote style="font-size:12px">Cerutti, S., Baselli, G., Civardi, S., Ferrazzi, E., Marconi, A. M., Pagani, M., & Pardi, G. (1986). Variability analysis of fetal heart rate signals as obtained from abdominal electrocardiographic recordings. Journal of Perinatal Medicine, 14(6), 445â€“452.</blockquote>

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> The  <code>FECGSYN_ts_extraction.m</code> function has several pre-built TS methods that can be used by simply substituting <code>'TS-CERUTTI'</code> for <code>'TS'</code>, <code>'TS-SUZANNA'</code>, <code>'TS-LP'</code> or <code>'TS-PCA'</code>. Make sure to see the <a href="{{site.github.url}}/pages/documentation.html#FECGSYN_ts_extraction"><span class="octicon octicon-globe"></span> Documentation</a>. </div></div>

<h2 id="main_extract_data">Multi-method extraction</h2>

<p>Aside from Template Subtraction methods (<code>FECGSYN_ts_extraction.m</code> function), the <em>FECGSYN</em> toolbox includes Blind Source Separation (<code>FECGSYN_bss_extraction.m</code> function), Kalman Filter (<code>FECGSYN_kf_extraction.m</code> function) and Adaptive Filters (<code>FECGSYN_adaptfilt_extraction.m</code> function). For more information, checkout Andreotti et al 2016 and the <a href="{{site.github.url}}/pages/documentation.html"><span class="octicon octicon-globe"></span> Documentation</a>.</p>

<p>In this example, extraction using every method available is performed by applying the <code>FECGSYN_main_extract.m</code> script. The script accepts WFDB formatted data, as well as <code>.mat</code> files (following <em>FECGSYN</em>'s structure). In order to inform the function which format is used, the bool <code>wfdb</code> should be toggled to <em>true</em> or <em>false</em>. The function comes with to preset pre-processing bands (3-100 Hz or 0.5-100 Hz) which can be set with the argument <code>narrowband</code>. The function may be applied directly on the FECGSYNDB, as follows:</p>

{% highlight matlab %}
slashchar = char('/'*isunix + '\'*(~isunix)); % find out OS
old_path=which('FECGSYN_UI') % find path to FECGSYN
pathdir = [old_path(1:end-12) slashchar 'data' slashchar]; % path to test.mat
wfdb = false; % true/false, data format in WFDB?
narrowband = false;  % preprocessing filtering band
ch = 3; % extract channel 3 of test data
refchs = 1; %  use channel 1 as reference
debug = 1;  % plot results
FECGSYN_main_extract(pathdir,narrowband,wfdb,ch,refchs,debug)
{% endhighlight %}

<p>This function saves each extracted signal in an separate <code>.mat</code> file under the directory <code>'path/data/ext/'</code>. In order to reduce the filenames, a coding is introduce consisting of 'rec' (for recording) and a number, followed by the extraction method used, for example <code>rec1_tsc.mat</code> or <code>rec5_PCA.mat</code>. An <code>index.mat</code> file is also saved on the folder to allow the backwards mapping of simulated and extracted datasets.</p>

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> For batch processing, avoid converting data to WFDB format, since it may cause slow downs. </div></div>
</section> <hr>

<!-------------Fetal SQI--------->
<section class="bs-docs-section">
<h1 id="fecgsqi" class="page-header">FECG Signal Quality Estimation</h1>

<p>This example demonstrates the signal quality estimation proposed in Andreotti et al 2017. This can be used to select/merge multichannel extracted FECG information or e.g. in BSS techniques component selection.  </p>
    
<p>First, we modify the <a href="{{site.github.url}}/pages/examples.html#datagen1"><span class="octicon octicon-arrow-small-up"></span> initial example</a> by simulating a minute of data and modulating noise functions to a sinusoidal function and a constant function by setting the variable, as follows: </p>

{% highlight matlab %}
param.fs = 1000; % data generation at 1kHz
param.n = 60*param.fs;
param.SNRfm = -3; % fetal maternal SNR
param.SNRmn = 8; % maternal to noise SNR
param.ntype = {'MA'}; % adding muscular artifact type noise
param.noise_fct = {arrayfun(@(x) 1+sin(5*pi*x),linspace(0,1,param.n)) 0.5}; % variable noise
debug = 0; % debug level (skip it)
out = run_ecg_generator(param,debug);
{% endhighlight %}

<p>Then extract a few channels of the produced simulation using for example the TSpca algorithm (Kanjilal <i>et al</i> 1997) using: </p>
    
{% highlight matlab %}
NbCycles = 20;
mixture = out.mixture([1 15 30],:);
for j = 1:size(mixture,1)
    residual(j,:) = FECGSYN_ts_extraction(out.mqrs,mixture(j,:),'TS-PCA',0,...
    NbCycles,'',out.param.fs);
end
{% endhighlight %}
    
<h2 id="sqi1">Single channel, single SQI example</h2>
    
    <p>This example illustrates how to produce a single signal quality estimate for a single channel segment using the <i>bsqi</i> algorithm (Li <i>et al</i> 2008), which compares how similar the result of two different QRS detectors are.</p>
    
    {% highlight matlab %}
    qrs1 = OSET_MaxSearch(residual(1,:),1.3/out.param.fs); % 2.3 Hz is the expected FHR parameter
    qrs2 = jqrs_mod(residual(1,:),0.25,0.3,out.param.fs,''); % refractory period and threshold as parameters
    sqi = bsqi(qrs1,qrs2,0.05,out.param.fs);
    sprintf('SQI for segment was equal %2.2f',sqi)
    {% endhighlight %}

    
  
    
<h2 id="sqi2">Multichannel SQI estimation</h2>    
    
    <p>Obviously, the previous example is suboptimal since we are estimating SQI for a complete 1 minute segment, during which we simulated a varying noise modulation. In the following example, the several SQI metrics used in Andreotti <i>et al</i> 2017 are applied. The example makes use of 5sec windows in calculating the different fetal SQI metrics for each channel. The results are saved in a table <code>sqi</code>. Further, the different metrics are then merged using the pre-trained Naive Bayes Classifier into one metric as follows:</p>
    
    {% highlight matlab %}
    sqi = main_sqi_analysis(out.mqrs,out.mecg,mixture,residual,out.param.fs,'testrec');    
    load('nbmodel.mat') % loading classifier
    for ch = 1:max(sqi.channel)
        idx = sqi.channel == ch;
        features = sqi{idx,5:end}; % obtaining features
        % estimate = nbmodel.predict(features);
        scores = nbmodel.posterior(features);           
        final_sqi(:,ch) =scores*[0 0.47 0.80 0.97 1]'; % coded values from Andreotti 2017
    end
    {% endhighlight %}
    
    <p>Where the columns of <code>final_sqi</code> represent the window-based SQI values for each of the available channels. The results for one of the channels (e.g. channel 2) can be plotted as:</p>
 
{% highlight matlab %}
ch = 2;
ax(1)=subplot(3,1,1);
plot(mixture(ch,:),'Color',[0.8 0.8 0.8])
hold on
plot(residual(ch,:),'b')
plot(qrs1,residual(ch,qrs1),'xr')
legend('abdmECG','FECG','FQRS')

ax(2)=subplot(3,1,2);
sqiidx = [10 30 35 40]; % see variable "sqi" for more info
plot(table2array(sqi(sqi.channel==ch,4)),table2array(sqi(sqi.channel==ch,sqiidx)))
legend(sqi.Properties.VariableNames(sqiidx))

ax(3)=subplot(3,1,3);
plot(table2array(sqi(sqi.channel==ch,4)),final_sqi(:,ch))
legend('Final SQI')
linkaxes(ax,'x');
 {% endhighlight %}

 <div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> Make sure WFDB Toolbox is installed, as it is required for the <code>gqrs()</code> and <code>wqrs()</code> detectors. For more information see <a href="{{site.github.url}}/pages/install.html#install-wfdb"><span class="octicon octicon-globe"></span> FECGSYN dependencies</a>. </div></div>
 
<h2 id="sqi3">Kalman filter FHR estimation</h2>    
 
 <p>In this section, the multichannel Kalman filter (KF) fetal heart rate (FHR) estimation is presented. Following the previous steps shown in the previous section ( <a href="{{site.github.url}}/pages/examples.html#sqi2"><span class="octicon octicon-arrow-small-up"></span> Multichannel SQI estimatione</a>), the FHR can be estimated by applying the function <code>runKFHR</code> as:</p>

 {% highlight matlab %}
 runKFHR(residual,final_sqi,out.fqrs{1},out.param.fs)
  {% endhighlight %}

 <p>The algorithm should plot the results for window-based FHR estimation using the method proposed by Li <em>et al</em> 2008.</p>
 
<p><b>References:</b></p>
    <blockquote style="font-size:12px">Andreotti et al. 2017 Non-Invasive Fetal ECG Signal Quality Assessment for Multichannel Heart Rate Estimation. IEEE Trans. Biomed. Eng. (in press). <br>
    Kanjilal, P. P., Palit, S., &amp; Saha, G. (1997). <a href="http://doi.org/10.1109/10.553712" data-toggle="tooltip" title="go to article" target="_blank">Fetal ECG extraction from single-channel maternal ECG using singular value decomposition.</a> <i>IEEE Trans. Biomed. Eng.</i>, 44(1), 51â€“9. <br>
    Li, Q., Mark, R. G., &amp; Clifford, G. D. (2008). <a href="http://doi.org/10.1088/0967-3334/29/1/002" data-toggle="tooltip" title="go to article" target="_blank">Robust heart rate estimation from multiple asynchronous noisy sources using signal quality indices and a Kalman filter.</a> <i> Physiol. Meas.</i>, 29(1), 15-32.     
    </blockquote>
 
</section>  <hr>

<!------------- Benchmarking --------->
<section class="bs-docs-section">
<h1 id="bench" class="page-header">Benchmarking Algorithms</h1>

The following examples assume that the user already extracted FECG from your dataset, or using the previous examples. In any case, <kbd>pathdir</kbd> should contain the path to the directory containing original and extracted data. Here is a minimal working example to prepare your workspace for the following examples:

{% highlight matlab %}
old_path=which('FECGSYN_UI'); % find path to FECGSYN
slashchar = char('/'*isunix + '\'*(~isunix)); % find out OS
path = [old_path(1:end-12) slashchar 'data' slashchar];
load([path 'test.mat'])% load test set
NbCycles = 20; % number of cycles used
ch = 3;
residual = FECGSYN_ts_extraction(out.mqrs,out.mixture(ch,:),'TS-CERUTTI',0,...
  NbCycles,'',out.param.fs);
{% endhighlight %}


<h2 id="fqrs">FQRS detection</h2>

<p>Single channel FQRS detection can be performed on extracted signals using the <code>qrs_detect.m</code> function by Behar et al 2014. The detector is a simple offline implementation of the Pan &amp; Tompkins algorithm, adapted for FECG (i.e. the refractory period is shorter than for adult ECG). The function returns the FQRS locations, given a <code>signal</code>, threshold level (<code>thr</code>, same unit as signal amplitude), refractory period (<code>refrac</code>, in s) and sampling frequency (<code>fs</code>, in Hz). It is called as <code>fqrs = qrs_detect(signal,thr,refrac,fs)</code>. The following example can be used subsequently to the <a href="{{site.github.url}}/pages/examples.html#tsc"><span class="octicon octicon-arrow-small-up"></span> Simple TSc Extraction Example</a>:</p>

{% highlight matlab %}
fqrs = qrs_detect(residual,0.25,0.100,250,[],[],1); % performs single channel FQRS detection
{% endhighlight %}

<p>The function <code>Bxb_compare.m</code>, based on Physionet's <code>bxb()</code>, enables the assessment on FQRS detection accuracy, in terms of F1-measure (<code>F1</code>), mean absolute error (<code>MAE</code> - a distance measure), positive predictive value (<code>PPV</code>), sensitivity (<code>SE</code>), number of true positives (<code>TP</code>), false negatives (<code>FN</code>) and false positives (<code>FP</code>). As input the reference (<code>out.fqrs{1}</code>) and test FQRS locations (<code>fqrs</code>) sould be provided, along with an acceptance interval (<code>acceptint</code> - in samples).</p>

{% highlight matlab %}
acceptint = 50*out.param.fs/1000; % 50 ms acceptance interval interval
[F1,MAE,PPV,SE,TP,FN,FP] = Bxb_compare(out.fqrs{1}, fqrs, acceptint)
{% endhighlight %}

<p> The function <code>FECGSYN_QRSmincompare.m</code> makes use of the <code>Bxb_compare.m</code> on a minute basis, as in Andreotti et al 2016. A broad benchmark across different methods is also available, however a slightly more complex test set is required. This dataset is generated and extracted using the following functions:</p>

{% highlight matlab %}
slashchar = char('/'*isunix + '\'*(~isunix)); % find out OS
narrowband = false;  % preprocessing filtering band
ch = 3; % extract channel 3 of test data
refchs = 1; %  use channel 1 as reference
wfdb = false; % true/false, data format in WFDB?
debug = 0;  % plot results
mkdir testset
cd testset
FECGSYNDBmini_datagen(pwd,0) % generates a miniture version of the FECGSYNDB set
FECGSYN_main_extract([pwd slashchar],narrowband,wfdb,ch,refchs,debug)
{% endhighlight %}

<div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> This example may take a couple minutes to execute.</div></div>

The function <code>FECGSYN_benchFQRS.m</code> is then used to benchmark the different methods applied on FQRS detection as follows:

{% highlight matlab %}
pathdir = pwd;% for original and extracted data
ch = [];  % ch = optional input, case data in WFDB format
debug = 5; % enable plotting
stats=FECGSYN_benchFQRS(pathdir,ch,debug)
{% endhighlight %}

<p><b>References:</b></p>
<blockquote style="font-size:12px">Pan, J., &amp; Tompkins, W. J. (1985). A Real-Time QRS Detection Algorithm. IEEE.J.BME, (3), 230â€“236.</blockquote>
<blockquote style="font-size:12px">Behar, J., Oster, J., &amp; Clifford, G. D. (2014). Combining and Benchmarking Methods of Foetal ECG Extraction Without Maternal or Scalp Electrode Data. Physiological Measurement, 35(8), 1569â€“1589.</blockquote>



<h2 id="morpho">Morphological Analysis</h2>

<p>Analogous to the FQRS detection benchmark, morphological features can be evaluated using the <code>FECGSYN_benchMorph.m</code> function. The function can be summarized into the following steps:</p>

<ul>
  <li>Template generation for reference and test signals</li>
  <li>Segmentation of templates using ECGPUWAVE (Jane et al 1997)</li>
  <li>Plausibility verification for segmented templates</li>
  <li>Fetal QT and T/QRS calculation</li>
</ul>

<p>The function may be called by using the following code (after obtaining the variables <code>pathdir</code>, <code>ch</code> and <code>debug</code> as previously shown):</p>
{% highlight matlab %}
ch = 1:8; % using channels from testset
morph=FECGSYN_benchMorph(pathdir,ch,debug)
{% endhighlight %}

<div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> Morphological analysis should consider a <code>pathdir</code> where extracted signals have a broader band than by the one used in <code>FECGSYN_benchFQRS.m</code>. This because a greater high-pass cut frequency will inevitably distort the FECG T-wave.</div></div>

<div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> <p>The script may take a while to run since it makes use of the ECGPUWAVE function, where several WFDB - Matlab transformations take place. If you are experiencing errors while running this function or no segmentation has taken place, chances are that your installation of the <a href="http://physionet.org/physiotools/matlab/wfdb-app-matlab/" target="_blank"><span class="octicon octicon-globe"></span> WFDB App for Matlab</a> is not working properly. In nominal function, some figures demonstrating successful segmentations should appear and  files with the extension <code>*.ecgpu</code> should be created on the current directory, which indicate that segmenation has taken place. In case of errors check the existence of these files and recheck your WFDB App installation.</p>

</div></div>

<p><b>Reference:</b></p>
<blockquote style="font-size:12px">Jane, R et al. 1997 Evaluation of An Automatic Threshold Based Detector of Waveform Limits in Holter ECG with the QT Database. Computers in Cardiology. </blockquote>

</section>  <hr>




<!-- -----------WFDB FECGSYN------- -->
<section class="bs-docs-section">
  <h1 id="wfdb" class="page-header">Convert to/from WFDB </h1>
  <p> WFDB is an open-source and widely used data format from Physionet (<a href="https://www.physionet.org"><span class="octicon octicon-globe"></span> www.physionet.org</a>). It is also the format adopted by the FECGSYNDB (<a href="https://www.physionet.org/physiotools/ipmcode/fecgsyn/"><span class="octicon octicon-globe"></span> available here</a>).</p>
  
  <p>The following subsections aim at demonstrating how to convert from <em>FECGSYN</em> Matlab/Octave format to WFDB format, and vice-versa. In order to use these functions, the WFDB App should be installed, as described in  <a href="{{site.github.url}}/pages/install.html"><span class="octicon octicon-globe"></span> Installing the <em>FECGSYN</em></a>.</p>
    
    
<h2 id="fecgsyn2wfdb">Converting FECGSYN to WFDB</h2>

  <p> This is done using the <code>fecgsyn2wfdb.m</code> function. The function can be used to convert multiple <code>.mat</code> saved files using <em>FECGSYN</em> internal structure, such as:</p>
  
{% highlight matlab %}
  fecgsyn2wfdb('/path_to_mats/')  
{% endhighlight %}
  
  Alternatively, a single file can be converted (e.g. during generation) by using the following input arguments:
  
  {% highlight matlab %}
  % outstruct = structure containing dataset (intern from FECGSYN)
  % recName = string containing name which will be used to save WFDB dataset
  % dest_path = string containing destination folder for WFDB dataset
  fecgsyn2wfdb(dest_path,outstruct,recName) 
{% endhighlight %} 
 
  <div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> Make sure to compress and convert the <code>outstruct</code> before exporting it to WFDB format. This can be done using the <code>clean_compress.m</code> function, see the <a href="{{site.github.url}}/pages/documentation.html#clean_compress"><span class="octicon octicon-globe"></span> Documentation</a>. </div></div>
  
  <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> You may have a look at function <code>exp_datagen1.m</code> function for a simple use of the <code>fecgsyn2wfdb.m</code>, see <a href="{{site.github.url}}/pages/examples.html#datagen2"><span class="octicon octicon-arrow-small-up"></span> this example</a>. </div></div>

<h2 id="wfdb2fecgsyn">Converting WFDB to FECGSYN</h2>

<p>Similarly, the <code>wfdb2fecgsyn.m</code> function is able to convert WFDB datasets into the <code>.mat</code> internal structure used by <em>FECGSYN</em>  <code>FECGSYN_main_extract.m</code> script. This function is particularly useful when converting the recordings from the <em>FECGSYNDB</em> to Matlab/Octave. An examplary code follows:</p>

{% highlight matlab %}
% pathdir = string containing origin folder for WFDB dataset
wfdb2fecgsyn(pathdir)
{% endhighlight %}

<div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> <code>pathdir</code> must be an unique identifier for a WFDB dataset, which excludes the extension of the files. For instance, for the <em>FECGSYNDB</em> <code>'sub01_snr00dB_l1_c0'</code> represents an unique identifier for a dataset consisting of multiple files: <code>_mecg</code>,<code>_fecg1</code>,<code>_noise1</code> with <code>.dat</code>, <code>.hea</code>, <code>.mqrs</code> and <code>.fqrs</code> extensions.</div></div>

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> You may have a look at function <code>main_extract_data.m</code> function for a simple use of the <code>wfdb2fecgsyn.m</code>, see <a href="{{site.github.url}}/pages/examples.html#main_extract_data"><span class="octicon octicon-globe"></span> this example</a>. </div></div>
</section> <hr>
